import type { Message } from "@mariozechner/pi-ai";
import type { AgentTransport } from "./transports/types.js";
import type { AgentEvent, AgentState, AppMessage, Attachment, ThinkingLevel } from "./types.js";
export interface AgentOptions {
    initialState?: Partial<AgentState>;
    transport: AgentTransport;
    messageTransformer?: (messages: AppMessage[]) => Message[] | Promise<Message[]>;
    queueMode?: "all" | "one-at-a-time";
}
export declare class Agent {
    private _state;
    private listeners;
    private abortController?;
    private transport;
    private messageTransformer;
    private messageQueue;
    private queueMode;
    private runningPrompt?;
    private resolveRunningPrompt?;
    constructor(opts: AgentOptions);
    get state(): AgentState;
    subscribe(fn: (e: AgentEvent) => void): () => void;
    setSystemPrompt(v: string): void;
    setModel(m: typeof this._state.model): void;
    setThinkingLevel(l: ThinkingLevel): void;
    setQueueMode(mode: "all" | "one-at-a-time"): void;
    getQueueMode(): "all" | "one-at-a-time";
    setTools(t: typeof this._state.tools): void;
    replaceMessages(ms: AppMessage[]): void;
    appendMessage(m: AppMessage): void;
    queueMessage(m: AppMessage): Promise<void>;
    clearMessageQueue(): void;
    clearMessages(): void;
    abort(): void;
    /**
     * Returns a promise that resolves when the current prompt completes.
     * Returns immediately resolved promise if no prompt is running.
     */
    waitForIdle(): Promise<void>;
    /**
     * Clear all messages and state. Call abort() first if a prompt is in flight.
     */
    reset(): void;
    prompt(input: string, attachments?: Attachment[]): Promise<void>;
    /**
     * Continue from the current context without adding a new user message.
     * Used for retry after overflow recovery when context already has user message or tool results.
     */
    continue(): Promise<void>;
    private _runAgentLoop;
    private _runAgentLoopContinue;
    private _prepareRun;
    private _processEvents;
    private emit;
}
//# sourceMappingURL=agent.d.ts.map